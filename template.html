<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<!--Generated by code-insight, visit http://github.com/xudifsd/code-insight for more information-->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>code-insight</title>
	<style>
	span {
		padding-left : 5px;
	}
	span#lineno {
		padding-right : 5px;
	}
	span#sorry{
		background : #ea3e3e;
	}
	span#lineno {
		background : white;
	}
	span#file_name{
		background : #65f9f0;
	}
	span#file_name:hover {
		background : #a2fbf0;
	}
	span#definition{
		background : #4141fb;
	}
	span#definition:hover {
		background : #5e5efb;
	}
	span#invocation{
		background : #ccf625;
	}
	span#invocation:hover {
		background : #ddf384;
	}
	div#file {
		display : inline;
		padding-right : 10px;
	}
	</style>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script type="text/javascript">
		var code_insight = {};
		code_insight.allFile = %s;/*this is for fprintf in c*/
		code_insight.createFileBlock = function(object){
			var rtn = $('<div id="file"></div>').append($('<span id="file_name"/>').attr("file_name", object["file_name"]).text(object["file_name"]));
			return rtn;
		};
		code_insight.createDefinitionBlock = function(object){	/*generate definition's div block*/
			var rtn = $('<div id="definition"/>');
			rtn.append($('<span id="file_name"/>').attr("file_name", object["file_name"]).text(object["file_name"] + ':'));
			rtn.append($('<span id="lineno"/>').text(object["lineno"]));
			rtn.append($('<span id="definition"/>').attr("function_name", object["function_name"]).text(object["return_value"] + " " + object["function_name"] + " " + object["args_list"]));
			return rtn;
		};
		code_insight.createInvocationBlock = function(object){
			var rtn = $('<div id="invocation"/>');
			rtn.append($('<span id="file_name"/>').attr("file_name", object["file_name"]).text(object["file_name"] + ":"));
			rtn.append($('<span id="lineno"/>').text(object["lineno"]));
			rtn.append($('<span id="definition"/>').attr("function_name",object["definition_name"]).text(object["definition_name"] + ":"));
			rtn.append($('<span id="invocation"/>').attr("function_name",object["function_name"]).text(object["function_name"] + " " + object["pars_list"]));
			return rtn;
		}
		code_insight.findDefinition = function(functionName){
			var rtn = [];
			for (var i = 0; i < code_insight.allDefinition.length; i++){
				if (functionName === code_insight.allDefinition[i]['function_name'])
					rtn.push(code_insight.allFile[i]);
			}
			return rtn;
		};
		code_insight.findInvocation = function(functionName){
			var rtn = [];
			for (var i = 0; i < code_insight.allInvocation.length; i++){
				if (functionName === code_insight.allInvocation[i]['function_name'])
					rtn.push(code_insight.allFile[i]);
			}
			return rtn;
		}
		code_insight.findDefinitionByFileName = function(fileName){
			var rtn = [];
			for(var i = 0; i < code_insight.allDefinition.length; i++){
				if (code_insight.allDefinition[i]["file_name"] === fileName){
					rtn.push(code_insight.allDefinition[i]);
				}
			}
			return rtn;
		}
		code_insight.findInvocationByDefinitionName = function(definitionName){
			var rtn = [];	/*there maybe same name definition*/
			for (var i = 0; i < code_insight.allInvocation.length; i++){
				if (code_insight.allInvocation[i]["definition_name"] === definitionName){
					rtn.push(code_insight.allInvocation[i]);
				}
			}
			return rtn;
		}
		code_insight.eventBind = function(){
			$('button#searchButton').click(function(){
				$('div#content').empty();
				$('div#loading').show();
				var definitionObjects = code_insight.findDefinition($('input#searchTerm').val());
				var invocationObjects = code_insight.findInvocation($('input#searchTerm').val());
				if (definitionObjects.length === 0){
					$('div#content').append($('<div/>').html('<span id="sorry">No definition of function named "'+ $('input#searchTerm').val() +'" found</span>'));
				} else {
					for (var i = 0; i < definitionObjects.length; i++){
						$('div#content').append(code_insight.createDefinitionBlock(definitionObjects[i]));
					}
				}
				if (invocationObjects.length === 0){
					$('div#content').append($('<div/>').html('<span id="sorry">No invocation of function named "'+ $('input#searchTerm').val() +'" found</span>'));
				} else {
					for (var i = 0; i < invocationObjects.length; i++){
						$('div#content').append(code_insight.createInvocationBlock(invocationObjects[i]));
					}
				}
				$('div#loading').hide();
			});
			$('span#file_name').click(function(){
				$('div#loading').show();
				$('div#content').empty();
				var objects = code_insight.findDefinitionByFileName($(this).attr('file_name'));
				if (objects.length === 0){
					$('div#content').append($('<div/>').html('<span id="sorry">No function defined in file "'+ $(this).attr('file_name') +'" found</span>'));
				} else {
					for (var i = 0; i < objects.length; i++){
						$('div#content').append(code_insight.createDefinitionBlock(objects[i]));
					}
				}
				code_insight.eventBind();
				$('div#loading').hide();
			});
			$('span#definition').click(function(){
				$('div#loading').show();
				$('div#content').empty();
				var objects = code_insight.findInvocationByDefinitionName($(this).attr('function_name'));
				if (objects.length === 0){
					$('div#content').append($('<div/>').html('<span id="sorry">No function invoked in function "'+ $(this).attr('function_name') +'" found</span>'));
				} else {
					for (var i = 0; i < objects.length; i++){
						$('div#content').append(code_insight.createInvocationBlock(objects[i]));
					}
				}
				code_insight.eventBind();
				$('div#loading').hide();
			});
			$('span#invocation').click(function(){
				$('div#loading').show();
				$('div#content').empty();
				var objects = code_insight.findDefinition($(this).attr('function_name'));
				if (objects.length === 0){
					$('div#content').append($('<div/>').html('<span id="sorry">No definition named "'+ $(this).attr('function_name') +'" found</span>'));
				} else {
					for (var i = 0; i < objects.length; i++){
						$('div#content').append(code_insight.createDefinitionBlock(objects[i]));
					}
				}
				code_insight.eventBind();
				$('div#loading').hide();
			});
		
		};
		$(document).ready(function(){
			for(var i = 0; i < code_insight.allFile.length; i++){	/*display all file at the beginning*/
				$('div#allFile').append(code_insight.createFileBlock(code_insight.allFile[i]));
			}
			code_insight.allDefinition = [];
			code_insight.allInvocation = [];
			for (var i = 0; i < code_insight.allFile.length; i++){
				for(var j = 0; j < code_insight.allFile[i]['definition_list'].length; j++){
					code_insight.allDefinition.push(code_insight.allFile[i]['definition_list'][j]);
				}
			}
			for (var i = 0; i < code_insight.allFile.length; i++){
				for (var j = 0; j < code_insight.allFile[i]['definition_list'].length; j++){
					for (var k = 0; k <code_insight.allFile[i]['definition_list'][j]['invocation_list'].length; k++){
						code_insight.allInvocation.push(code_insight.allFile[i]['definition_list'][j]['invocation_list'][k]);
					}
				}
			}
			$('a#allFile').click(function(){
				$('div#allFile').slideToggle('fast');
			});
			code_insight.eventBind();
			$('div#loading').hide();
		});
	</script>
</head>
<body>
<div id="topbar">
	<input id="searchTerm" style="width:200px;height:15px;"></input>
	<button id="searchButton">search function</button>
	<span id="sorry">not found</span>
	<span id="file_name">file name</span>
	<span id="definition">function definition</span>
	<span id="invocation">function invocation</span>
</div>
<a href="#" id="allFile">All file in project</a>
<div id="allFile">
</div>
<hr/>
<div id="content"></div>
<div id="loading"><span style="font-size:30px;">Loading ...</span></div>
</body>
</html>
